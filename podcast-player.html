<link rel="import" href="bower_components/paper-material/paper-material.html" />
<link rel="import" href="bower_components/paper-fab/paper-fab.html" />
<link rel="import" href="bower_components/iron-icons/iron-icons.html" />
<link rel="import" href="bower_components/iron-icons/av-icons.html" />
<link rel="import" href="bower_components/paper-progress/paper-progress.html" />

<dom-module id="podcast-player">
	<style>
		:host {
			width: 100%;
			height: 100px;
			background-color: var(--dark-primary-color);
			position: relative;
		}
		paper-fab {
			position: absolute;
			top: -25px;
			left: 25px;
			z-index: 25;
		}
		paper-progress {
			position: absolute;
			bottom: 0;
			width: 100%;
			--paper-progress-active-color: var(--light-primary-color);
			--paper-progress-container-color: var(--default-primary-color);
		}
	</style>
	<template>
		<paper-fab id="playbutton" disabled icon="av:play-arrow" on-click="togglePlay"></paper-fab>
		<paper-progress value="10"></paper-progress>
		<paper-material id="container" elevation="1">
		</paper-material>
		<script type="text/javascript" src="wavesurfer.min.js" onload='document.querySelector("podcast-player").updateWavesurfer();'></script>
	</template>
</dom-module>
<script>
	( function () {
		Polymer({
			is: 'podcast-player',
			properties: {
				src: {
					type: String,
					value: '',
					notify: true
				},
				name: {
					type: String,
					value: '',
					notify: true
				},
				wavesurfer: {
					type: Object
				}
			},
			initWaveSurfer: function() {
				var self = this;
				this.wavesurfer.init({
					container: this.$.container,
//					progressColor: '#f16529',
//					waveColor: '#e44d26',
					waveColor: 'violet',
					progressColor: 'purple',
					fillParent: true,
					height: 100
				});
				this.wavesurfer.on('ready', function () {
					self.$.playbutton.removeAttribute('disabled');
				});
				this.wavesurfer.load(this.src);
			},
			updateWavesurfer: function() {
				this.wavesurfer = Object.create(WaveSurfer);
				this.initWaveSurfer();
			},
			togglePlay: function(e) {
				this.wavesurfer.playPause();
				var iconType = this.$.playbutton.getAttribute('icon');
				if(iconType === 'av:play-arrow') {
					this.$.playbutton.setAttribute('icon', 'av:pause');
				} else {
					this.$.playbutton.setAttribute('icon', 'av:play-arrow');
				}
			}
		});
	})();
</script>