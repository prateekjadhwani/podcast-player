<link rel="import" href="../paper-material/paper-material.html" />
<link rel="import" href="../paper-fab/paper-fab.html" />
<link rel="import" href="../paper-icon-button/paper-icon-button.html" />
<link rel="import" href="../iron-icons/iron-icons.html" />
<link rel="import" href="../iron-icons/av-icons.html" />
<link rel="import" href="../paper-progress/paper-progress.html" />
<link rel="import" href="../neon-animation/neon-animated-pages.html">
<link rel="import" href="../neon-animation/neon-animations.html">
<link rel="import" href="control-box.html" />

<dom-module id="podcast-player">
	<style>
		:host {
			width: 100%;
			height: 150px;
			background-color: var(--dark-primary-color);
			position: relative;
		}
		.controls {
			transition: all 1s ease;
			position: absolute;
			height: 50px;
			width: 100%;
			float: left;
			top: 0px;
			left: 0px;
			background: var(--accent-color);
			z-index: 20;
		}
		paper-fab {
			transition: all 1s ease;
			top: -25px;
			left: 25px;
			z-index: 25;
			border-radius:0;
			position: absolute;
		}
		.waveContainer {
			transition: all 1s ease;
			background-color: var(--dark-primary-color);
			top: 25px;
			transform: scaleY(1.5);
		}
		.circleAnimation {
			border-radius: 50%;
		}
		.playActive {
			position: absolute;
			top: 0px;
			left: 0px;
			width: 100%;
			height: 50px;
		}
		.waveActive {
			top: 50px;
			transform: scaleY(1);
		}
		.hidden {
			display: none;
		}
	</style>
	<template>

		<paper-fab id="playbutton" class="controlp circleAnimation" disabled icon="av:play-arrow" on-click="togglePlay"></paper-fab>
		
		<paper-material  class="controls hidden" elevation="2">
		<paper-icon-button style="color: white;" icon="av:pause" on-click="togglePlay"></paper-icon-button>
		I'm the bar that's being animated to!
		</paper-material>

		<paper-material id="container" class="waveContainer" elevation="0">
		</paper-material>
		
		<script type="text/javascript" src="wavesurfer.min.js" onload='document.querySelector("podcast-player").updateWavesurfer();'></script>
	</template>
</dom-module>
<script>
	( function () {
		Polymer({
			is: 'podcast-player',
			properties: {
				src: {
					type: String,
					value: '',
					notify: true
				},
				name: {
					type: String,
					value: '',
					notify: true
				},
				wavesurfer: {
					type: Object
				},
				wavecolor: {
					type: String,
					value: '#ffffff',
					notify: true
				},
				progresscolor: {
					type: String,
					value: '#CFD8DC',
					notify: true
				}
			},
			initWaveSurfer: function() {
				var self = this;
				this.wavesurfer.init({
					container: this.$.container,
//					progressColor: '#f16529',
//					waveColor: '#e44d26',
					waveColor: this.wavecolor,
					progressColor: this.progresscolor, // --primary-background-color
					fillParent: true,
					height: 100
				});
				this.wavesurfer.on('ready', function () {
					document.querySelector('#playbutton').removeAttribute('disabled');
				});
				this.wavesurfer.load(this.src);
			},
			updateWavesurfer: function() {
				this.wavesurfer = Object.create(WaveSurfer);
				this.initWaveSurfer();
			},
			togglePlay: function(e) {
			var waveStyle = Polymer.dom(this.root).querySelector('.waveContainer');
			var buttonStyle = Polymer.dom(this.root).querySelector('#playbutton');
			var controlsStyle = Polymer.dom(this.root).querySelector('.controls');
				this.wavesurfer.playPause();
				var iconType = this.$.playbutton.getAttribute('icon');
				if(iconType === 'av:play-arrow') {
					buttonStyle.setAttribute('icon', 'av:pause');
					buttonStyle.classList.remove("circleAnimation");
					buttonStyle.classList.add("playActive");
					waveStyle.classList.add("waveActive");
					setTimeout(function() {
						controlsStyle.classList.remove("hidden");
						buttonStyle.classList.add("hidden");
					},1000);
				} else {
					controlsStyle.classList.add("hidden");
					buttonStyle.classList.remove("hidden");
					setTimeout(function() {
						buttonStyle.setAttribute('icon', 'av:play-arrow');
						buttonStyle.classList.add("circleAnimation");
						buttonStyle.classList.remove("playActive");
						waveStyle.classList.remove("waveActive");
						buttonStyle.querySelector('paper-material').classList.add("hidden");
					},1);
				}
			}
		});
	})();
</script>
